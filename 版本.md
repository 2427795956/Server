# 版本历史
每形成一个阶段性版本就在此进行一下总结，回顾一下整体架构，思考未来改进的方向

## 0.1
看了muduo，同时参考了网上其他人写的，根据自己的理解，以及muduo源码，编写了一个web服务器
![0.1框架](/assets/0.1框架.png)
整体框架如图，主reactor负责接收新的连接，建立连接后分配给某个SubReactor。跨线程调用利用回调函数队列实现，需要加锁，锁的竞争只在MainReactor和某一SubReactor之间，不同SubReactor之间没有联系。
### Key Points
* 使用epoll水平触发+非阻塞IO，使用reactor模式
* 采用one loop per thread结构，使用多线程充分利用多核CPU，并使用线程池避免创建销毁的开销
* 使用eventfd实现了线程的异步唤醒
* 使用基于小根堆的定时器，主要用于HTTP超时关闭，使用timerfd唤醒等待线程
* 使用双缓冲技术，实现了简单的异步日志
* 使用了RAII技术设计了多个类
* 解析了HTTP请求(GET HEAD)，支持长短连接

一些问题：
1. accept的个数
三种策略：accept一个，accept N个，accept直至没有连接到达。长短连接适合的方式？
2. 其他唤醒方式
使用pipe进行唤醒，让IO线程监控管道是否可读
3. 什么时候需要用锁？
多个线程需要访问共有变量的时候需要加锁，项目中均采用RAII设计的互斥锁进行临界区的保护。
锁的争用只在主线程和IO线程中，具体在几个地方：需要更改跨线程回调函数列表时，等待子线程创建时，日志前后端访问缓冲区时
4. epoll和poll以及select的对比？为什么高效？
